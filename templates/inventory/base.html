<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="csrf-token" content="{{ csrf_token }}" />
  <title>Fridgventory</title>
  <link rel="stylesheet" href="/static/css/base.css" />
  <link rel="stylesheet" href="/static/css/emoji-picker/emoji.css" />
  <script>
    (function() {
      const KEY = 'theme';
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      const saved = localStorage.getItem(KEY);
      const initTheme = saved || (prefersDark ? 'dark' : 'light');
      document.documentElement.setAttribute('data-theme', initTheme);
      function setTheme(theme) {
        document.documentElement.setAttribute('data-theme', theme);
        localStorage.setItem(KEY, theme);
        const btn = document.getElementById('theme-toggle');
        const icon = document.querySelector('.theme-icon');
        const text = document.querySelector('.theme-text');
        if (btn && icon && text) {
          if (theme === 'dark') {
            icon.textContent = '‚òÄÔ∏è';
            text.textContent = btn.getAttribute('data-light-label');
          } else {
            icon.textContent = 'üåô';
            text.textContent = btn.getAttribute('data-dark-label');
          }
        }
      }
      window.addEventListener('DOMContentLoaded', function() {
        setTheme(document.documentElement.getAttribute('data-theme'));
        const btn = document.getElementById('theme-toggle');
        if (btn) btn.addEventListener('click', function() {
          const current = document.documentElement.getAttribute('data-theme');
          setTheme(current === 'dark' ? 'light' : 'dark');
        });

        // Language toggle button flips en <-> cs
        const langToggle = document.getElementById('language-toggle');
        const langForm = document.getElementById('language-form');
        const langInput = document.getElementById('language-select');
        const nextInput = document.getElementById('lang-next');
        const langCodeDisplay = document.querySelector('.lang-code');
        
        if (langToggle && langForm && langInput && nextInput) {
          const path = window.location.pathname;
          const m = path.match(/^\/(en|cs)(\/|$)/);
          const current = m ? m[1] : 'en';
          const target = current === 'en' ? 'cs' : 'en';
          
          // Update the display to show current language
          if (langCodeDisplay) {
            langCodeDisplay.textContent = current.toUpperCase();
          }
          
          langToggle.addEventListener('click', function() {
            const pathname = window.location.pathname;
            let newPath;
            const re = new RegExp('^\/(en|cs)(\/|$)');
            if (re.test(pathname)) {
              newPath = pathname.replace(re, `/${target}$2`);
            } else {
              newPath = `/${target}` + (pathname.startsWith('/') ? '' : '/') + pathname;
            }
            langInput.value = target;
            nextInput.value = newPath + window.location.search;
            langForm.submit();
          });
        }

        // Hamburger menu functionality
        const navbarToggle = document.getElementById('navbar-toggle');
        const navbarNav = document.getElementById('navbar-nav');
        
        if (navbarToggle && navbarNav) {
          navbarToggle.addEventListener('click', function() {
            navbarNav.classList.toggle('active');
            navbarToggle.classList.toggle('active');
          });

          // Close menu when clicking on a nav link (mobile)
          const navLinks = document.querySelectorAll('.nav-link');
          navLinks.forEach(link => {
            link.addEventListener('click', function() {
              navbarNav.classList.remove('active');
              navbarToggle.classList.remove('active');
            });
          });

          // Close menu when clicking outside (mobile)
          document.addEventListener('click', function(event) {
            const isClickInsideNav = navbarNav.contains(event.target);
            const isClickOnToggle = navbarToggle.contains(event.target);
            
            if (!isClickInsideNav && !isClickOnToggle && navbarNav.classList.contains('active')) {
              navbarNav.classList.remove('active');
              navbarToggle.classList.remove('active');
            }
          });
        }
      });
    })();
  </script>
</head>
<body>
  <header class="navbar">
    {% load static %}
    <div class="navbar-brand">
      <a href="{% url 'inventory:index' %}" class="logo-link">
        <img src="{% static 'media/logo.jpeg' %}" alt="Fridgventory Logo" class="logo">
      </a>
      <a href="{% url 'inventory:index' %}" class="title-link" style="text-decoration: none;">
        <h1>Fridgventory</h1>
      </a>
    </div>

    <!-- Hamburger menu button for mobile -->
    <button class="navbar-toggle" id="navbar-toggle" aria-label="Toggle navigation">
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </button>

    <!-- Navigation menu -->
    <nav class="navbar-nav" id="navbar-nav">
      {% load i18n %}
      <div class="nav-links">
        <a href="{% url 'inventory:index' %}" class="nav-link">
          <span class="nav-icon">üè†</span>
          <span class="nav-text">{% trans "Home" %}</span>
        </a>
        <a href="{% url 'inventory:item_create' %}" class="nav-link">
          <span class="nav-icon">‚ûï</span>
          <span class="nav-text">{% trans "Define New Item" %}</span>
        </a>
        
        <!-- Action buttons group -->
        <div class="nav-action-group">
          <button type="button" class="nav-link action-btn" id="consume-btn">
            <span class="nav-icon">üçΩÔ∏è</span>
            <span class="nav-text">{% trans "Consume" %}</span>
          </button>
          <button type="button" class="nav-link action-btn" id="inventorize-btn">
            <span class="nav-icon">üìä</span>
            <span class="nav-text">{% trans "Inventorize" %}</span>
          </button>
        </div>
        
        <a href="{% url 'inventory:settings' %}" class="nav-link">
          <span class="nav-icon">‚öôÔ∏è</span>
          <span class="nav-text">{% trans "Settings" %}</span>
        </a>
        <a href="{% url 'inventory:shopping_list_text' %}" class="nav-link">
          <span class="nav-icon">üìù</span>
          <span class="nav-text">{% trans "Shopping list (txt)" %}</span>
        </a>
        <a href="{% url 'inventory:shopping_list_image' %}" class="nav-link">
          <span class="nav-icon">üñºÔ∏è</span>
          <span class="nav-text">{% trans "Shopping list (png)" %}</span>
        </a>
      </div>

      <!-- Controls section -->
      <div class="navbar-controls">
        <form id="language-form" action="{% url 'set_language' %}" method="post" class="lang-form">
          {% csrf_token %}
          <input id="lang-next" type="hidden" name="next" value="{{ request.get_full_path }}" />
          <input id="language-select" type="hidden" name="language" value="" />
          <button type="button" id="language-toggle" class="btn lang-btn" title="{% trans 'Switch language' %}">
            <span class="lang-icon">üåê</span>
            <span class="lang-code">EN</span>
          </button>
        </form>
        <button id="theme-toggle" class="btn theme-btn" data-dark-label="{% trans "Dark mode" %}" data-light-label="{% trans "Light mode" %}">
          <span class="theme-icon">üåô</span>
          <span class="theme-text">{% trans "Dark mode" %}</span>
        </button>
      </div>
    </nav>
  </header>
  <main>
    {% block content %}{% endblock %}
  </main>
  
  <!-- Emoji Picker JavaScript -->
  <script src="/static/js/emoji-picker/emoji-picker.js"></script>
</body>
</html>
