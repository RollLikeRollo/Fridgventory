<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fridgventory</title>
  <link rel="stylesheet" href="/static/css/base.css" />
  <script>
    (function() {
      const KEY = 'theme';
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      const saved = localStorage.getItem(KEY);
      const initTheme = saved || (prefersDark ? 'dark' : 'light');
      document.documentElement.setAttribute('data-theme', initTheme);
      function setTheme(theme) {
        document.documentElement.setAttribute('data-theme', theme);
        localStorage.setItem(KEY, theme);
        const btn = document.getElementById('theme-toggle');
        if (btn) btn.textContent = theme === 'dark' ? btn.getAttribute('data-light-label') : btn.getAttribute('data-dark-label');
      }
      window.addEventListener('DOMContentLoaded', function() {
        setTheme(document.documentElement.getAttribute('data-theme'));
        const btn = document.getElementById('theme-toggle');
        if (btn) btn.addEventListener('click', function() {
          const current = document.documentElement.getAttribute('data-theme');
          setTheme(current === 'dark' ? 'light' : 'dark');
        });

        // Language toggle button flips en <-> cs
        const langToggle = document.getElementById('language-toggle');
        const langForm = document.getElementById('language-form');
        const langInput = document.getElementById('language-select');
        const nextInput = document.getElementById('lang-next');
        const langCodeDisplay = document.querySelector('.lang-code');
        
        if (langToggle && langForm && langInput && nextInput) {
          const path = window.location.pathname;
          const m = path.match(/^\/(en|cs)(\/|$)/);
          const current = m ? m[1] : 'en';
          const target = current === 'en' ? 'cs' : 'en';
          
          // Update the display to show current language
          if (langCodeDisplay) {
            langCodeDisplay.textContent = current.toUpperCase();
          }
          
          langToggle.addEventListener('click', function() {
            const pathname = window.location.pathname;
            let newPath;
            const re = new RegExp('^\/(en|cs)(\/|$)');
            if (re.test(pathname)) {
              newPath = pathname.replace(re, `/${target}$2`);
            } else {
              newPath = `/${target}` + (pathname.startsWith('/') ? '' : '/') + pathname;
            }
            langInput.value = target;
            nextInput.value = newPath + window.location.search;
            langForm.submit();
          });
        }
      });
    })();
  </script>
</head>
<body>
  <header>
    {% load static %}
    <a href="{% url 'inventory:index' %}" class="logo-link">
      <img src="{% static 'media/logo.jpeg' %}" alt="Fridgventory Logo" class="logo">
    </a>
    <h1>Fridgventory</h1>
    <nav>
      {% load i18n %}
      <a href="{% url 'inventory:index' %}" class="btn">{% trans "Home" %}</a>
      <a href="{% url 'inventory:item_create' %}" class="btn">{% trans "Add Item" %}</a>
      <a href="{% url 'inventory:shopping_list_text' %}" class="btn">{% trans "Shopping list (txt)" %}</a>
      <a href="{% url 'inventory:shopping_list_image' %}" class="btn">{% trans "Shopping list (png)" %}</a>
    </nav>
    <span class="ml-auto"></span>
    <form id="language-form" action="{% url 'set_language' %}" method="post" class="lang-form">
      {% csrf_token %}
      <input id="lang-next" type="hidden" name="next" value="{{ request.get_full_path }}" />
      <input id="language-select" type="hidden" name="language" value="" />
      <button type="button" id="language-toggle" class="btn lang-btn" title="{% trans 'Switch language' %}">
        <span class="lang-icon">üåê</span>
        <span class="lang-code">EN</span>
      </button>
    </form>
    <button id="theme-toggle" class="btn" data-dark-label="{% trans "Dark mode" %}" data-light-label="{% trans "Light mode" %}">{% trans "Dark mode" %}</button>
  </header>
  <main>
    {% block content %}{% endblock %}
  </main>
</body>
</html>
